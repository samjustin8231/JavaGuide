

# 持久化

Redis提供了两种持久化方案：RDB持久化和AOF持久化，一个是快照的方式，一个是类似日志追加的方式



# RDB
RDB持久化是通过快照的方式，即在指定的时间间隔内将内存中的数据集快照写入磁盘。在创建快照之后，用户可以备份该快照，可以将快照复制到其他服务器以创建相同数据的服务器副本，或者在重启服务器后恢复数据。RDB是Redis默认的持久化方式

RDB持久化会生成RDB文件，该文件是一个压缩过的二进制文件，可以通过该文件还原快照时的数据库状态，即生成该RDB文件时的服务器数据。RDB文件默认为当前工作目录下的dump.rdb，可以根据配置文件中的dbfilename和dir设置RDB的文件名和文件位置

> 触发快照的时机

* 执行save和bgsave命令
* 配置文件设置save <seconds> <changes>规则，自动间隔性执行bgsave命令
* 主从复制时，从库全量复制同步主库数据，主库会执行bgsave
* 执行flushall命令清空服务器数据
* 执行shutdown命令关闭Redis时，会执行save命令

> save和bgsave命令

执行save和bgsave命令，可以手动触发快照，生成RDB文件，两者的区别如下

使用save命令会阻塞Redis服务器进程，服务器进程在RDB文件创建完成之前是不能处理任何的命令请求

而使用bgsave命令不同的是，basave命令会fork一个子进程，然后该子进程会负责创建RDB文件，而服务器进程会继续处理命令请求



# AOF

todo

# 参考文献

* [Redis持久化机制：RDB和AOF](https://juejin.im/post/5d776dcef265da03b574744d)

